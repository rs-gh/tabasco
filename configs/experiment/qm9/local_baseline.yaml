# @package _global_
# Local testing config for M3 Mac - baseline WITHOUT REPA
# Use this to compare against qm9_chemprop_local (with REPA)
defaults:
  - /experiment/qm9/baseline

tags: ["qm9", "baseline", "local"]

datamodule:
  batch_size: 32  # Smaller batch for local testing
  num_workers: 0  # Avoid multiprocessing issues on Mac

model:
  net:
    hidden_dim: 64  # Smaller model for faster iteration
    num_layers: 4   # Fewer layers
    num_heads: 4

  # No REPA loss - this is the baseline
  repa_loss: null

callbacks:
  ema: null  # Disable EMA - has issues with MPS
  dataset_stats:
    _target_: tabasco.callbacks.DatasetStatsCallback
  mol_metrics:
    _target_: tabasco.callbacks.MoleculeMetricsCallback
    num_samples: 20
    compute_every: 1
    num_sampling_steps: 50
  posebusters_metrics:
    _target_: tabasco.callbacks.PoseBustersCallback
    num_samples: 20
    compute_every: 1
    num_sampling_steps: 50
  save_mols:
    _target_: tabasco.callbacks.SaveGeneratedMolsCallback
    num_samples: 20
    num_display_mols: 5
    num_trajectories: 3
    num_sampling_steps: 50
    compute_every: 1

trainer:
  max_epochs: 3  # Quick test
  accelerator: mps  # Use Apple Silicon GPU
  devices: 1
  log_every_n_steps: 10

logger:
  wandb:
    name: "${now:%m%d-%H%M}-tabasco-qm9-baseline-local"
